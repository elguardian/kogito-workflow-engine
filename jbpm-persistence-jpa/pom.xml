<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.jbpm</groupId>
    <artifactId>jbpm</artifactId>
    <version>5.2.0-SNAPSHOT</version>
  </parent>

  <artifactId>jbpm-persistence-jpa</artifactId>

  <name>jBPM :: JPA Persistence</name>
  <description>jBPM JPA Persistence</description>

  <build>
    <testResources>
        <testResource>
            <!-- neccesary in order to apply database/H2 properties -->
            <directory>src/test/resources</directory>
            <filtering>true</filtering>
        </testResource>
    </testResources>
  
    <plugins>
      <plugin>
        <artifactId>maven-jar-plugin</artifactId>
        <configuration>
          <archive>
            <manifestFile>META-INF/MANIFEST.MF</manifestFile>
          </archive>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.felix</groupId>
        <artifactId>maven-bundle-plugin</artifactId>
        <extensions>true</extensions>
        <executions>
          <execution>
            <id>manifest</id>
            <phase>process-classes</phase>
            <goals>
              <goal>manifest</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <manifestLocation>META-INF</manifestLocation>
          <instructions>
            <_removeheaders>Ignore-Package</_removeheaders>
            <Bundle-SymbolicName>org.jbpm.flow-persistence-jpa;singleton:=true</Bundle-SymbolicName>
            <Require-Bundle>org.drools.core;bundle-version="${drools.osgi.version}",org.drools.compiler;bundle-version="${drools.osgi.version}"</Require-Bundle>
            <Import-Package>*</Import-Package>
            <Export-Package>org.jbpm.persistence.*</Export-Package>
            <DynamicImport-Package>*</DynamicImport-Package>
          </instructions>
        </configuration>
      </plugin>
    </plugins>
  </build>
    
  <dependencies> 	       
    <dependency>
      <groupId>org.jbpm</groupId>
      <artifactId>jbpm-flow-builder</artifactId>
    </dependency>
    <dependency>
      <groupId>org.drools</groupId>
      <artifactId>drools-persistence-jpa</artifactId>
    </dependency>
    <dependency>
      <groupId>org.hibernate</groupId>
      <artifactId>hibernate-annotations</artifactId>
      <scope>compile</scope>
    </dependency>
    <dependency>
      <groupId>org.drools</groupId>
      <artifactId>drools-persistence-jpa</artifactId>
      <type>test-jar</type>
      <scope>test</scope>
    </dependency>    
    <dependency>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-log4j12</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>com.h2database</groupId>
      <artifactId>h2</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.codehaus.btm</groupId>
      <artifactId>btm</artifactId>
      <scope>test</scope>
    </dependency>    		
    <dependency>
      <groupId>org.apache.felix</groupId>
      <artifactId>org.osgi.core</artifactId>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>org.apache.felix</groupId>
      <artifactId>org.osgi.compendium</artifactId>
      <scope>provided</scope>
    </dependency>
    <!-- Following 2 dependencies needed for making the build work with JDK5 -->
    <dependency>
      <groupId>com.sun.xml.bind</groupId>
      <artifactId>jaxb-impl</artifactId>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>com.sun.xml.bind</groupId>
      <artifactId>jaxb-xjc</artifactId>
      <scope>provided</scope>
    </dependency>
  </dependencies>
  
  
  <!--
     These are properties used in the database profiles. Some of them must be initialized
     them to be empty so that Maven applies them via filtering to the resources. 
     -->
  <properties>
    <maven.hibernate.dialect>org.hibernate.dialect.H2Dialect</maven.hibernate.dialect>
    <maven.datasource.classname>org.h2.jdbcx.JdbcDataSource</maven.datasource.classname>
    <maven.jdbc.driver.class>org.h2.Driver</maven.jdbc.driver.class>
          
    <maven.jdbc.db.name>mydb</maven.jdbc.db.name>
    <maven.jdbc.db.port/>
    <maven.jdbc.db.server/>
          
    <maven.jdbc.driver.dir/>
    <maven.jdbc.driver.jar/>
         
    <maven.jdbc.username>sa</maven.jdbc.username>
    <maven.jdbc.password>sasa</maven.jdbc.password>
    <maven.jdbc.url>jdbc:h2:mem:mydb</maven.jdbc.url>
  </properties>
  
  <profiles>
    <profile>
       <id>database</id>
       
       <dependencies>
         <!--  Add the downloaded jdbc driver jar for the database to the classpath.
               !: <groupId>, <artifactId> and <version> are just placeholders and DO NOT MATTER! -->
         <dependency>
            <groupId>org.jbpm</groupId>
            <artifactId>downloaded-jdbc-driver-jar</artifactId>
            <version>1.0</version>
            <scope>system</scope>
            <systemPath>${maven.jdbc.driver.jar}</systemPath>
         </dependency>  
       </dependencies>
    </profile>
    
    <!--  
    The following is an example of how to test with a particular database:
    
    <profile>
        <id>postgresql</id>
        
        <properties>
          <! see http://docs.jboss.org/hibernate/core/3.6/reference/en-US/html/session-configuration.html#configuration-optional-dialects 
          <maven.hibernate.dialect>org.hibernate.dialect.PostgreSQLDialect</maven.hibernate.dialect>
          <!  helpful: http://docs.jboss.org/ironjacamar/userguide/1.0/en-US/html/ex_datasources.html 
          <maven.datasource.classname>org.postgresql.xa.PGXADataSource</maven.datasource.classname>
          <maven.jdbc.driver.class>org.postgresql.Driver</maven.jdbc.driver.class>
          
          <maven.jdbc.db.name>jbpm3</maven.jdbc.db.name>
          <maven.jdbc.db.port>5432</maven.jdbc.db.port>
          <maven.jdbc.db.server>localhost</maven.jdbc.db.server>
           
          <! This is the local path of the jdbc driver jar needed 
          <maven.jdbc.driver.jar>/opt/bin/jenkins-1.409.1/jobs/jbpm5-db/workspace/database/postgresql84/postgresql-8.4-702.jdbc3.jar</maven.jdbc.driver.jar>
         
          <maven.jdbc.username>jbpm3</maven.jdbc.username>
          <maven.jdbc.password>jbpm3</maven.jdbc.password>
          <maven.jdbc.url>jdbc:postgresql://localhost:5432/jbpm3</maven.jdbc.url>
        </properties>

         <! Add the downloaded jdbc driver jar for the database to the classpath
         <! !: Both <groupId> and <artifactId> are just placeholders and DO NOT MATTER!
        
        <dependencies>
          <dependency>
            <groupId>org.jboss</groupId>
            <artifactId>downloaded-jdbc-driver-jar</artifactId>
            <version>1.0</version>
            <scope>system</scope>
            <systemPath>${maven.jdbc.driver.jar}</systemPath>
          </dependency>
        </dependencies>
    </profile>
  </profiles>
    -->
  
</project>
